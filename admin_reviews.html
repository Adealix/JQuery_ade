<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Reviews Management - GadgetEssence Admin</title>

    <!-- Latest compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.16.1/sweetalert2.css"
      integrity="sha512-fjO3Vy3QodX9c6G9AUmr6WuIaEPdGRxBjD7gjatG5gGylzYyrEq3U0q+smkG6CwIY0L8XALRFHh4KPHig0Q1ug=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.3.0/css/responsive.bootstrap4.min.css">

    <!-- Animate.css for enhanced animations -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
      crossorigin="anonymous"
    />

    <!-- Custom GadgetEssence CSS -->
    <link rel="stylesheet" href="css/style.css" />

    <script
      src="https://code.jquery.com/jquery-3.6.4.min.js"
      integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.16.1/sweetalert2.min.js"
      integrity="sha512-LGHBR+kJ5jZSIzhhdfytPoEHzgaYuTRifq9g5l6ja6/k9NAOsAi5dQh4zQF6JIRB8cAYxTRedERUF+97/KuivQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.3.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.3.0/js/responsive.bootstrap4.min.js"></script>
</head>
<body>
    <!-- GadgetEssence Header -->
    <div id="header"></div>

    <!-- Main Admin Container -->
    <div class="gadget-admin-container">
        <div class="container-fluid">
            <!-- Page Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="admin-header-card">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="admin-title">
                                    <i class="fas fa-star-half-alt text-warning"></i>
                                    Reviews Management
                                </h2>
                                <p class="admin-subtitle">Manage customer reviews and ratings</p>
                            </div>
                            <div class="admin-stats">
                                <div class="stat-item">
                                    <span class="stat-number" id="totalReviews">0</span>
                                    <span class="stat-label">Total Reviews</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number" id="averageRating">0.0</span>
                                    <span class="stat-label">Avg Rating</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters and Actions -->
            <div class="row mb-3">
                <div class="col-md-8">
                    <div class="filter-controls">
                        <select id="ratingFilter" class="form-control d-inline-block" style="width: auto;">
                            <option value="">All Ratings</option>
                            <option value="5">⭐⭐⭐⭐⭐ (5 Stars)</option>
                            <option value="4">⭐⭐⭐⭐ (4 Stars)</option>
                            <option value="3">⭐⭐⭐ (3 Stars)</option>
                            <option value="2">⭐⭐ (2 Stars)</option>
                            <option value="1">⭐ (1 Star)</option>
                        </select>
                        <select id="statusFilter" class="form-control d-inline-block ml-2" style="width: auto;">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="hidden">Hidden</option>
                            <option value="reported">Reported</option>
                        </select>
                        <button class="btn btn-outline-secondary ml-2" id="clearFilters">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>
                <div class="col-md-4 text-right">
                    <button class="btn btn-success" id="addReviewBtn">
                        <i class="fas fa-plus"></i> Add Review
                    </button>
                    <button class="btn btn-info ml-2" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Reviews DataTable -->
            <div class="row">
                <div class="col-12">
                    <div class="card gadget-card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-list"></i> Reviews List
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table id="reviewsTable" class="table table-striped table-bordered table-hover">
                                    <thead class="gadget-table-header">
                                        <tr>
                                            <th>ID</th>
                                            <th>Customer</th>
                                            <th>Item</th>
                                            <th>Rating</th>
                                            <th>Review Text</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Dynamic content -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Review Modal -->
    <div class="modal fade" id="reviewModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header gadget-modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-star"></i>
                        <span id="modalTitle">Add Review</span>
                    </h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="reviewForm">
                        <input type="hidden" id="reviewId" name="review_id">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="customerId">Customer *</label>
                                    <select class="form-control" id="customerId" name="customer_id" required>
                                        <option value="">Select Customer</option>
                                        <!-- Will be populated dynamically -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="itemId">Item *</label>
                                    <select class="form-control" id="itemId" name="item_id" required>
                                        <option value="">Select Item</option>
                                        <!-- Will be populated dynamically -->
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="rating">Rating *</label>
                                    <div class="rating-input">
                                        <div class="star-rating" id="starRating">
                                            <i class="fas fa-star" data-rating="1"></i>
                                            <i class="fas fa-star" data-rating="2"></i>
                                            <i class="fas fa-star" data-rating="3"></i>
                                            <i class="fas fa-star" data-rating="4"></i>
                                            <i class="fas fa-star" data-rating="5"></i>
                                        </div>
                                        <input type="hidden" id="rating" name="rating" required>
                                        <small class="form-text text-muted">Click on stars to rate</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="status">Status</label>
                                    <select class="form-control" id="status" name="status">
                                        <option value="active">Active</option>
                                        <option value="hidden">Hidden</option>
                                        <option value="reported">Reported</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="reviewText">Review Text *</label>
                            <textarea class="form-control" id="reviewText" name="review_text" rows="4" 
                                      placeholder="Enter review text..." required></textarea>
                            <small class="form-text text-muted">Minimum 10 characters</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="saveReviewBtn">
                        <i class="fas fa-save"></i> Save Review
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Review Modal -->
    <div class="modal fade" id="viewReviewModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header gadget-modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-eye"></i>
                        Review Details
                    </h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="viewReviewContent">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom styles for this page -->
    <style>
        .star-rating {
            font-size: 1.5rem;
            color: #ddd;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .star-rating i {
            transition: color 0.2s;
            margin-right: 5px;
        }

        .star-rating i:hover,
        .star-rating i.active {
            color: #ffc107;
        }

        .rating-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .rating-5 { background-color: #28a745; color: white; }
        .rating-4 { background-color: #17a2b8; color: white; }
        .rating-3 { background-color: #ffc107; color: #212529; }
        .rating-2 { background-color: #fd7e14; color: white; }
        .rating-1 { background-color: #dc3545; color: white; }

        .status-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-active { background-color: #d4edda; color: #155724; }
        .status-hidden { background-color: #f8d7da; color: #721c24; }
        .status-reported { background-color: #fff3cd; color: #856404; }

        .review-text-preview {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .admin-stats {
            display: flex;
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #6c757d;
            text-transform: uppercase;
        }

        .filter-controls {
            display: inline-flex;
            align-items: center;
        }

        .btn-action {
            padding: 2px 8px;
            font-size: 0.75rem;
            margin: 1px;
        }
    </style>

    <script src="js/admin_reviews.js"></script>

    <script>
        // Authentication check
        $(function() {
            $("#header").load("header.html", function() {
                // Check if user is admin after header loads
                const userId = sessionStorage.getItem('userId') ? JSON.parse(sessionStorage.getItem('userId')) : null;
                const jwtToken = sessionStorage.getItem('jwtToken') || '';
                
                if (!userId || !jwtToken) {
                    sessionStorage.clear();
                    window.location.href = 'login.html';
                    return;
                }

                // Check admin role (you might need to adjust this based on your user data structure)
                if (userId.role !== 'admin') {
                    Swal.fire({
                        icon: 'error',
                        title: 'Access Denied',
                        text: 'You do not have permission to access this page.',
                        confirmButtonColor: '#667eea'
                    }).then(() => {
                        window.location.href = 'home.html';
                    });
                    return;
                }

                // Update navigation for admin
                if (sessionStorage.getItem('userId')) {
                    const $loginLink = $('a.nav-link[href="login.html"]');
                    $loginLink.text('Logout').attr({ 'href': '#', 'id': 'logout-link' }).on('click', function (e) {
                        e.preventDefault();
                        Swal.fire({
                            title: 'Logout Confirmation',
                            text: 'Are you sure you want to logout?',
                            icon: 'question',
                            showCancelButton: true,
                            confirmButtonColor: '#667eea',
                            cancelButtonColor: '#6c757d',
                            confirmButtonText: '<i class="fas fa-sign-out-alt"></i> Yes, Logout',
                            cancelButtonText: '<i class="fas fa-times"></i> Cancel'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                sessionStorage.clear();
                                window.location.href = 'login.html';
                            }
                        });
                    });
                    $('a.nav-link[href="register.html"]').closest('.nav-item').hide();
                }
            });
        });
    </script>
</body>
</html>
